# Myomyw数据包协议 v0.8

（暂未实现）

以下部分数据包使用http格式，内容均为json格式，由客户端发起

路径格式：http: //server-address/action 

METHOD: GET

## 用户和账户

### 握手 (handshake)

| 参数名  | 描述         | 类型   |
| ------- | ------------ | ------ |
| version | 客户端的版本 | string |

#### 应答

| 参数名     | 描述                 | 类型 |
| ---------- | ------------------- | ---- |
| error_code | 0为成功，1为版本不匹配 | int  |

---

### 登录（待完善）(login)


| 参数名  | 描述    | 类型   |
| ------ | ------- | ------ |
| name   | 玩家名称 | string |

#### 应答

| 参数名    | 描述                | 类型 |
| -------- | ------------------- | ---- | 
| token    | JWT格式，如失败长度为0 | string |

---

## 房间

### 创建房间 (room/create)

| 参数名          | 描述       | 类型   |
| -------------- | ---------- | ------ |
| token          | JWT令牌     | string |
| public         | 是否公开    | bool  |
| as_competitor  | 是否作为玩家 | bool  |
| allow_watching | 是否允许观战 | bool  |

#### 应答

| 参数名      | 描述                 | 类型 |
| ---------- | -------------------- | ---- |
| error_code | 见下表                | int  |
| room       | 房间号                | int  |
| session_id | WS登陆参数，有效一分钟  | int  |

| error_code | 描述                  |
| ---------- | -------------------- |
| 0          | 成功                  |
| 9999       | 服务器已满             |

### 加入房间 (room/join)

| 参数名          | 描述       | 类型   |
| -------------- | ---------- | ------ |
| token          | JWT令牌     | string |
| room           | 房间号      | int    |
| as_competitor  | 是否作为玩家 | bool   |

#### 应答

| 参数名      | 描述                 | 类型 |
| ---------- | -------------------- | ---- |
| error_code | 见下表                | int  |
| session_id | WS登陆参数，有效一分钟  | int  |

| error_code | 描述                  |
| ---------- | -------------------- |
| 0          | 成功                  |
| 1          | 无此房间               |
| 2          | 已开赛，作为观众        |
| 3          | 房间人数超过上限        |
| 9999       | 服务器已满             |

### 匹配房间 (room/auto_match)

| 参数名          | 描述        | 类型   |
| -------------- | ---------- | ------ |
| token          | JWT令牌     | string |
| allow_watching | 是否允许观战 | bool   |

#### 应答

| 参数名      | 描述                 | 类型 |
| ---------- | -------------------- | ---- |
| error_code | 见下表                | int  |
| room       | 房间号                | int  |
| session_id | WS登陆参数，有效一分钟  | int  |

| error_code | 描述                  |
| ---------- | -------------------- |
| 0          | 成功                  |
| 1          | 匹配超时               |
| 9998       | 由用户终止             |
| 9999       | 服务器已满             |

### 取消匹配房间 (room/cancel_match)

| 参数名          | 描述        | 类型   |
| -------------- | ---------- | ------ |
| token          | JWT令牌     | string |

#### 应答

| 参数名      | 描述                 | 类型 |
| ---------- | -------------------- | ---- |
| error_code | 见下表                | int  |

| error_code | 描述                  |
| ---------- | -------------------- |
| 0          | 成功                  |
| 1          | 未在匹配               |

## 游戏过程

Myomyw的游戏数据包分为action和json格式的包内容两段，格式为`action$@@${"parameter":"something"}`

### 移动球

| action | 发送方        | 是否需要回应 |
| ------ | ------------- | ------------ |
| move   | client/server | 否           |

| 参数名  | 描述                           | 类型   |
| ------- | ------------------------------ | ------ |
| col     | 移动的列（非第一次移动可省略） | int    |

---

### 结束回合

| action   | 发送方        | 是否需要回应 |
| -------- | ------------- | ------------ |
| end_turn | client/server | 否           |

（无参数）

---

### 下一个球

| action    | 发送方 | 是否需要回应 |
| --------- | ------ | ------------ |
| next_ball | server | 否           |

| 参数名 | 描述           | 类型 |
| ------ | -------------- | ---- |
| ball   | 下一个球的类别 | int  |

### 认输

| action  | 发送方 | 是否需要回应 |
| ------- | ------ | ------------ |
| give_up | client | 否           |

（无参数）

### 游戏结束

| action   | 发送方 | 是否需要回应 |
| -------- | ------ | ------------ |
| end_game | server | 否           |

| 参数名 | 描述               | 类型 |
| ------ | ------------------ | ---- |
| reason | 结束原因（见下表） | int  |

| reason | 描述       |
| ------ | ---------- |
| 0      | 服务器关闭 |
| 1      | 对手离开   |
| 2      | 玩家胜利   |
| 3      | 对手胜利   |
| 4      | 玩家超时   |
| 5      | 对手超时   |
| 6      | 玩家认输   |
| 7      | 对手认输   |

---

### 异常

通知游戏过程中出现的异常，如玩家移动时服务器认为不是该玩家的回合，或服务器与客户端的胜负判定不符。这通常意味着客户端被修改或游戏出现bug

| action    | 发送方        | 是否需要回应 |
| --------- | ------------- | ------------ |
| exception | client/server | 否           |

| 参数名      | 描述     | 类型   |
| ----------- | -------- | ------ |
| description | 描述异常 | string |

---

### 发送聊天

| action    | 发送方 | 是否需要回应 |
| --------- | ------ | ------------ |
| exception | client | 否           |

| 参数名 | 描述     | 类型   |
| ------ | -------- | ------ |
| text   | 聊天内容 | string |

---

### 广播聊天

| action | 发送方 | 是否需要回应 |
| ------ | ------ | ------------ |
| chat   | client | 否           |

| 参数名 | 描述     | 类型   |
| ------ | -------- | ------ |
| sender | 发送者   | string |
| text   | 聊天内容 | string |

---

