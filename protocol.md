# Myomyw数据包协议 v0.8

（暂未实现）

Myomyw的数据包分为action和json格式的包内容两段，格式为`action$@@${"parameter":"something"}`

部分数据包需要回应，回应数据包中action为`reply`

## 用户和账户

### 握手

| action    | 发送方 | 是否需要回应 |
| --------- | ------ | ------------ |
| handshake | client | 是           |

| 参数名  | 描述         | 类型   |
| ------- | ------------ | ------ |
| version | 客户端的版本 | string |

#### reply

| 参数名     | 描述                   | 类型 |
| ---------- | ---------------------- | ---- |
| error_code | 0为成功，1为版本不匹配 | int  |

---

### 登录（待完善）

| action | 发送方 | 是否需要回应 |
| ------ | ------ | ------------ |
| login  | client | 是           |

| 参数名 | 描述     | 类型   |
| ------ | -------- | ------ |
| name   | 玩家名称 | string |

#### reply

| 参数名     | 描述             | 类型 |
| ---------- | ---------------- | ---- |
| error_code | 0为成功，1为失败 | int  |

---

## 房间

### 开始匹配

| action         | 发送方 | 是否需要回应 |
| -------------- | ------ | ------------ |
| start_matching | client | 是           |

| 参数名         | 描述         | 类型 |
| -------------- | ------------ | ---- |
| allow_watching | 是否允许观战 | bool |

#### reply

| 参数名     | 描述   | 类型 |
| ---------- | ------ | ---- |
| error_code | 见下表 | int  |

| error_code | 描述                   |
| ---------- | ---------------------- |
| 0          | 成功                   |
| 1          | 未登录（即未提供昵称） |
| 2          | 服务器已满             |

---

### 停止匹配

| action        | 发送方 | 是否需要回应 |
| ------------- | ------ | ------------ |
| stop_matching | client | 否           |

（无参数）

---

### 匹配成功

| action           | 发送方 | 是否需要回应 |
| ---------------- | ------ | ------------ |
| matching_success | server | 否           |

| 参数名        | 描述     | 类型   |
| ------------- | -------- | ------ |
| opponent_name | 对手名称 | string |
| room_id       | 房间号   | string |

---

### 创建房间

| action      | 发送方 | 是否需要回应 |
| ----------- | ------ | ------------ |
| create_room | client | 是           |

| 参数名         | 描述         | 类型 |
| -------------- | ------------ | ---- |
| allow_watching | 是否允许观战 | bool |

#### reply

| 参数名     | 描述   | 类型   |
| ---------- | ------ | ------ |
| error_code | 见下表 | int    |
| room_id    | 房间号 | string |

| error_code | 描述                   |
| ---------- | ---------------------- |
| 0          | 成功                   |
| 1          | 未登录（即未提供昵称） |
| 2          | 服务器已满             |

---

### 观战

| action | 发送方 | 是否需要回应 |
| ------ | ------ | ------------ |
| watch  | client | 是           |

| 参数名  | 描述   | 类型 |
| ------- | ------ | ---- |
| room_id | 房间号 | int  |

#### reply

| 参数名     | 描述                           | 类型 |
| ---------- | ------------------------------ | ---- |
| error_code | 见下表                         | int  |
| turn       | 当前是谁的回合（0为左，1为右） | int  |

| error_code | 描述             |
| ---------- | ---------------- |
| 0          | 成功             |
| 1          | 房间不存在       |
| 2          | 房间不允许观战   |
| 3          | 观战人数达到上限 |

---

## 游戏过程

### 移动球

| action | 发送方        | 是否需要回应 |
| ------ | ------------- | ------------ |
| move   | client/server | 否           |

| 参数名  | 描述                           | 类型   |
| ------- | ------------------------------ | ------ |
| col     | 移动的列（非第一次移动可省略） | int    |

---

### 结束回合

| action   | 发送方        | 是否需要回应 |
| -------- | ------------- | ------------ |
| end_turn | client/server | 否           |

（无参数）

---

### 填充球池

开始游戏时填充到满，随后每推出一个球后填充一个

| action    | 发送方 | 是否需要回应 |
| --------- | ------ | ------------ |
| fill_pool | server | 否           |

| 参数名   | 描述                                                         | 类型  |
| -------- | ------------------------------------------------------------ | ----- |
| ball_seq | 要加入球池的球的从先出到后出的序列数组（球的具体类型见下表） | int[] |

| id   | 球的类型 |
| ---- | -------- |
| 0    | 普通球   |
| 1    | 关键球   |
| 2    | 增列球   |
| 3    | 减列球   |
| 4    | 翻转球   |

---

### 认输

| action  | 发送方 | 是否需要回应 |
| ------- | ------ | ------------ |
| give_up | client | 否           |

（无参数）

---

### 游戏结束

| action   | 发送方 | 是否需要回应 |
| -------- | ------ | ------------ |
| end_game | server | 否           |

| 参数名 | 描述               | 类型 |
| ------ | ------------------ | ---- |
| reason | 结束原因（见下表） | int  |

| reason | 描述       |
| ------ | ---------- |
| 0      | 服务器关闭 |
| 1      | 对手离开   |
| 2      | 玩家胜利   |
| 3      | 对手胜利   |
| 4      | 玩家超时   |
| 5      | 对手超时   |
| 6      | 玩家认输   |
| 7      | 对手认输   |

---

### 异常

通知游戏过程中出现的异常，如玩家移动时服务器认为不是该玩家的回合，或服务器与客户端的胜负判定不符。这通常意味着客户端被修改或游戏出现bug

| action    | 发送方        | 是否需要回应 |
| --------- | ------------- | ------------ |
| exception | client/server | 否           |

| 参数名      | 描述     | 类型   |
| ----------- | -------- | ------ |
| description | 描述异常 | string |

---

### 发送聊天

| action    | 发送方 | 是否需要回应 |
| --------- | ------ | ------------ |
| exception | client | 否           |

| 参数名 | 描述     | 类型   |
| ------ | -------- | ------ |
| text   | 聊天内容 | string |

---

### 广播聊天

| action | 发送方 | 是否需要回应 |
| ------ | ------ | ------------ |
| chat   | client | 否           |

| 参数名 | 描述     | 类型   |
| ------ | -------- | ------ |
| sender | 发送者   | string |
| text   | 聊天内容 | string |

---

